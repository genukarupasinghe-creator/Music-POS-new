<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Musical Show - Book Now</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 400px; margin-bottom: 20px; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; box-sizing: border-box; }
        button { background: #007bff; color: white; font-weight: bold; border: none; cursor: pointer; }
        .check-btn { background: #28a745; }
        #qrcode-container { display: none; }
    </style>
</head>
<body>
    <div class="card">
        <h2>ðŸŽ¸ Book Your Ticket</h2>
        <input type="text" id="custName" placeholder="à¶”à¶¶à·š à¶±à¶¸">
        <select id="showSelector">
            <option value="Flashback Live">Flashback Live - Rs. 2000</option>
            <option value="Sunflower Unplugged">Sunflower Unplugged - Rs. 5000</option>
        </select>
        <button onclick="bookTicket()">Request Booking</button>
    </div>
    <div class="card">
        <h3>âœ… Get Your Ticket</h3>
        <input type="text" id="checkID" placeholder="Reference ID">
        <button class="check-btn" onclick="downloadVerifiedTicket()">Download Ticket PDF</button>
    </div>
    <div id="qrcode-container"></div>
    <script>
        // âš ï¸ à¶¸à·™à¶­à¶±à¶§ à¶”à¶ºà·à¶œà·š Firebase Config à¶‘à¶š à¶…à¶±à·’à·€à·à¶»à·Šà¶ºà¶ºà·™à¶±à·Š à¶¯à·à¶±à·Šà¶±
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function bookTicket() {
            const name = document.getElementById('custName').value;
            const show = document.getElementById('showSelector').value;
            if(!name) return alert("à¶±à¶¸ à¶‡à¶­à·”à·…à¶­à·Š à¶šà¶»à¶±à·Šà¶±");
            db.collection("bookings").add({
                customerName: name,
                showName: show,
                status: "pending",
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            }).then(docRef => {
                alert("Success! Your ID: " + docRef.id);
            });
        }

        function downloadVerifiedTicket() {
            const id = document.getElementById('checkID').value;
            db.collection("bookings").doc(id).get().then(doc => {
                if(doc.exists && doc.data().status === "verified") {
                    generatePDF(doc.data().customerName, doc.data().showName, id);
                } else {
                    alert("à¶­à·€à¶¸ Verified à¶šà¶» à¶±à·à¶­!");
                }
            });
        }

        function generatePDF(name, show, id) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const qrContainer = document.getElementById('qrcode-container');
            qrContainer.innerHTML = '';
            new QRCode(qrContainer, { text: id, width: 100, height: 100 });
            setTimeout(() => {
                const qrImg = qrContainer.getElementsByTagName('img')[0].src;
                doc.text("OFFICIAL TICKET", 105, 20, null, null, "center");
                doc.text(`Name: ${name}`, 20, 40);
                doc.text(`Show: ${show}`, 20, 50);
                doc.addImage(qrImg, 'PNG', 75, 70, 60, 60);
                doc.save(`Ticket_${name}.pdf`);
            }, 500);
        }
    </script>
</body>
</html>
